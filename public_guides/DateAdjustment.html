
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Date Adjustment in Python &#8212; SML Public Methods</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'public_guides/DateAdjustment';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Selective Editing in Python" href="SelectiveEditing.html" />
    <link rel="prev" title="Cell Key Perturbation in Python" href="CellKeyPerturbation_Py.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.svg" class="logo__image only-light" alt="SML Public Methods - Home"/>
    <script>document.write(`<img src="../_static/logo.svg" class="logo__image only-dark" alt="SML Public Methods - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    SML User Guides
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Methods</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="CellKeyPerturbation_Py.html">Cell Key Perturbation in Python</a></li>




<li class="toctree-l1 current active"><a class="current reference internal" href="#">Date Adjustment in Python</a></li>




<li class="toctree-l1"><a class="reference internal" href="SelectiveEditing.html">Selective Editing in Python</a></li>




<li class="toctree-l1"><a class="reference internal" href="ThousandPoundCorrection.html">Thousand Pound Correction in Python</a></li>




<li class="toctree-l1"><a class="reference internal" href="TotalsAndComponents.html">Totals and Components in Python</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Accessibility</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../AccessibilityStatement.html">Accessibility Statement</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ONSDigital/sml-jbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ONSDigital/sml-jbook/issues/new?title=Issue%20on%20page%20%2Fpublic_guides/DateAdjustment.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/public_guides/DateAdjustment.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Date Adjustment in Python</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Date Adjustment in Python</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sml-user-guide">SML User Guide</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#user-notes">User Notes</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-and-installing-the-method">Finding and Installing the method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements-and-dependencies">Requirements and Dependencies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions-and-validity">Assumptions and Validity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-the-method">How to Use the Method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-input">Method Input</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#input-data">Input Data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#trading-day-data">Trading Day Data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-output">Method Output</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#output-data">Output Data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-synthetic-data">Example (Synthetic) Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#worked-example">Worked Example</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">Methodology</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#terminology">Terminology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-process-flow-formal-definition">Statistical Process Flow / Formal Definition</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-information">Additional Information</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#license">License</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="date-adjustment-in-python">
<h1>Date Adjustment in Python<a class="headerlink" href="#date-adjustment-in-python" title="Link to this heading">#</a></h1>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="sml-user-guide">
<h1>SML User Guide<a class="headerlink" href="#sml-user-guide" title="Link to this heading">#</a></h1>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p>Descriptive</p></th>
<th class="head text-left"><p>Details</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Support Area</p></td>
<td class="text-left"><p>Editing &amp; Imputation</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Method Theme</p></td>
<td class="text-left"><p>Editing</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Status</p></td>
<td class="text-left"><p>Ready to Use</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Inputs</p></td>
<td class="text-left"><p>input_dataframe, trading_weights, target_columns, contributor_returned_start_date_col, contributor_returned_end_date_col, expected_start_date_col, expected_end_date_col, domain_col, short_period_parameter_col, long_period_parameter_col, equal_weighted_col, set_to_mid_point_col, use_calendar_days_col, average_weekly_col, da_error_flag_col, trading_date_col, trading_period_start_col, trading_period_end_col, trading_weights_col, trading_domain_col</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Outputs</p></td>
<td class="text-left"><p>dataframe with adjusted responses and sum of the weights</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Method Version</p></td>
<td class="text-left"><p>1.2.5</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Code Repository</p></td>
<td class="text-left"><p><a class="github reference external" href="https://github.com/ONSdigital/sml-python-small/blob/main/sml_small/date_adjustment.py">ONSdigital/sml-python-small</a></p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>To generate summary and headline statistics for a reporting period it is important to ensure that data reported are on a consistent basis referencing the same period. However, sometimes it is not possible for data to be reported for the exact period of time required, e.g., monthly, quarterly, yearly. The responder may specify different start and end dates for which the observed (referenced as response throughout this specification) data cover. The Date Adjustment method weights the data values from the response period to approximate the values for the desired (expected) period, either by giving varying weights to trading days or giving each date the same weight.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="user-notes">
<h1>User Notes<a class="headerlink" href="#user-notes" title="Link to this heading">#</a></h1>
<section id="finding-and-installing-the-method">
<h2>Finding and Installing the method<a class="headerlink" href="#finding-and-installing-the-method" title="Link to this heading">#</a></h2>
<p><strong>This method requires Python &gt;=3.7.1, &lt;4.0.0 and uses the Pandas package v1.5.3.</strong></p>
<p>If you are using Pandas &gt;=2.0 this will be uninstalled and v1.5.3 installed.</p>
<blockquote>
<div><p><sub>To prevent downgrading software on your system, we recommend creating a virtual environment to install and run SML methods. This will enable you to install the method with the required version of Python, etc, without disrupting the newer versions you may be running on your system. If you’re new to virtual environments, please see our guidence on installing a method in the Help centre of our SML website to get started. Otherwise, use your preferred method to create a virtual environment with the correct software versions.</sub></p>
</div></blockquote>
<p>The method package can be installed from Artifactory/PyPI using the following code in the terminal or command prompt:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">sml_small</span> 
</pre></div>
</div>
<p>In your code you can import the method using:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sml_small.date_adjustment</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">date_adjust</span>
</pre></div>
</div>
</section>
<section id="requirements-and-dependencies">
<h2>Requirements and Dependencies<a class="headerlink" href="#requirements-and-dependencies" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>This method requires input data and trading day data.</p></li>
<li><p>These each need to be supplied as a pandas dataframe.</p></li>
</ul>
</section>
<section id="assumptions-and-validity">
<h2>Assumptions and Validity<a class="headerlink" href="#assumptions-and-validity" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>All data inputs required by the method are available.</p></li>
<li><p>Each respondent is clearly classified into one mutually exclusive domain group.</p></li>
<li><p>All trading day weights are equal or greater than 0.</p></li>
<li><p>Trading day weights are available for all periods and domains, or the equal weighted option is set to yes.</p></li>
</ul>
</section>
<section id="how-to-use-the-method">
<h2>How to Use the Method<a class="headerlink" href="#how-to-use-the-method" title="Link to this heading">#</a></h2>
<section id="method-input">
<h3>Method Input<a class="headerlink" href="#method-input" title="Link to this heading">#</a></h3>
<p>The method requires input data and trading day data.</p>
<section id="input-data">
<h4>Input Data<a class="headerlink" href="#input-data" title="Link to this heading">#</a></h4>
<p>The input data requires the following columns to perform the date adjustment method:</p>
<ul class="simple">
<li><p>Reference: Unique to each respondent</p></li>
<li><p>Contributors start date: Start date returned by the contributor.</p></li>
<li><p>Contributors end date: End date returned by the contributor.</p></li>
<li><p>Q20: Variable response that needs to be date adjusted.</p></li>
<li><p>Expected start date: Start date the user is expecting from the contributor.</p></li>
<li><p>Expected end date: End date the user is expecting from the contributor</p></li>
<li><p>Domain: Domain classification.</p></li>
<li><p>Mid-point: Indicator as to whether the mid-point method needs to be used.</p></li>
<li><p>Equal-weighted: Indicator as to whether the equal-weighted method needs to be used.</p></li>
<li><p>Calendar days: Indicator as to whether the calendar days method needs to be used.</p></li>
<li><p>Average weekly: Indicator as to whether the average weekly method needs to be used.</p></li>
<li><p>Short period: A value that shows the user whether a response is of a short time frame.</p></li>
<li><p>Long period: A value that shows the user whether a response is of a long-time frame.</p></li>
<li><p>Error column: A column that will be populated if any errors occur.</p></li>
</ul>
<p><strong>Example</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Reference</p></th>
<th class="head"><p>Contributors start date</p></th>
<th class="head"><p>Contributors end date</p></th>
<th class="head"><p>Q20</p></th>
<th class="head"><p>Expected start date</p></th>
<th class="head"><p>Expected end date</p></th>
<th class="head"><p>Domain</p></th>
<th class="head"><p>Mid-point</p></th>
<th class="head"><p>Equal-weighted</p></th>
<th class="head"><p>Calendar days</p></th>
<th class="head"><p>Average Weekly</p></th>
<th class="head"><p>Short period</p></th>
<th class="head"><p>Long period</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
<td><p>1184</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>20220604</p></td>
<td><p>20220630</p></td>
<td><p>2045</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>20220601</p></td>
<td><p>20220624</p></td>
<td><p>2013</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>20220601</p></td>
<td><p>20220704</p></td>
<td><p>1992</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>20220530</p></td>
<td><p>20220628</p></td>
<td><p>1027</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="trading-day-data">
<h4>Trading Day Data<a class="headerlink" href="#trading-day-data" title="Link to this heading">#</a></h4>
<p>The trading day data requires trading day weights for all dates present and for the domain we are interested in:</p>
<ul class="simple">
<li><p>Date: Date we are interested in</p></li>
<li><p>Domain: Domain classification</p></li>
<li><p>Weight: Weight for the specific trading day</p></li>
<li><p>Period: An indicator of the period.</p></li>
<li><p>Period_start: Start date of the period</p></li>
<li><p>Period_end: End date of the period</p></li>
</ul>
<p>**Example **</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>date</p></th>
<th class="head"><p>domain</p></th>
<th class="head"><p>weight</p></th>
<th class="head"><p>period</p></th>
<th class="head"><p>period_start</p></th>
<th class="head"><p>period_end</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>20220528</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202205</p></td>
<td><p>20220501</p></td>
<td><p>20220531</p></td>
</tr>
<tr class="row-odd"><td><p>20220529</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202205</p></td>
<td><p>20220501</p></td>
<td><p>20220531</p></td>
</tr>
<tr class="row-even"><td><p>20220530</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202205</p></td>
<td><p>20220501</p></td>
<td><p>20220531</p></td>
</tr>
<tr class="row-odd"><td><p>20220531</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202205</p></td>
<td><p>20220501</p></td>
<td><p>20220531</p></td>
</tr>
<tr class="row-even"><td><p>20220601</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220602</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220603</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220604</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220605</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220606</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220607</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220608</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220609</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220610</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220611</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220612</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220613</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220614</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220615</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220616</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220617</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220618</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220619</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220620</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220621</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220622</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220623</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220624</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220625</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220626</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220627</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220628</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220629</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-odd"><td><p>20220630</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202206</p></td>
<td><p>20220601</p></td>
<td><p>20220630</p></td>
</tr>
<tr class="row-even"><td><p>20220701</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202207</p></td>
<td><p>20220701</p></td>
<td><p>20220731</p></td>
</tr>
<tr class="row-odd"><td><p>20220702</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202207</p></td>
<td><p>20220701</p></td>
<td><p>20220731</p></td>
</tr>
<tr class="row-even"><td><p>20220703</p></td>
<td><p>A</p></td>
<td><p>0</p></td>
<td><p>202207</p></td>
<td><p>20220701</p></td>
<td><p>20220731</p></td>
</tr>
<tr class="row-odd"><td><p>20220704</p></td>
<td><p>A</p></td>
<td><p>0.2</p></td>
<td><p>202207</p></td>
<td><p>20220701</p></td>
<td><p>20220731</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="method-output">
<h3>Method Output<a class="headerlink" href="#method-output" title="Link to this heading">#</a></h3>
<section id="output-data">
<h4>Output Data<a class="headerlink" href="#output-data" title="Link to this heading">#</a></h4>
<p>New columns are produced from running the method and are described below:</p>
<ul class="simple">
<li><p>Sum of trading day weights over contributors period: The trading day weights will be summed over the dates returned, all dates are inclusive.</p></li>
<li><p>Number of days in contributors returned period: The number of days returned by the contributor, all dates are inclusive.</p></li>
<li><p>Actual period start date: The start date the user is looking for (usually similar to expected start date).</p></li>
<li><p>Actual period end date: The end date the user is looking for (usually similar to expected end date).</p></li>
<li><p>Number of days in actual returned period: The number of days the user set</p></li>
<li><p>Sum of trading day weights over actual period: The sum of the trading weights over the days set by the user.</p></li>
<li><p>Date adjusted Q20: The adjusted question value based on the sum of the trading days weights ratio.</p></li>
</ul>
<p><strong>Example</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Ref</p></th>
<th class="head"><p>Contributors start date</p></th>
<th class="head"><p>Contributors end date</p></th>
<th class="head"><p>Q20</p></th>
<th class="head"><p>Expected start date</p></th>
<th class="head"><p>Expected end date</p></th>
<th class="head"><p>Domain</p></th>
<th class="head"><p>Mid-point</p></th>
<th class="head"><p>Equal-weighted</p></th>
<th class="head"><p>Calendar days</p></th>
<th class="head"><p>Average Weekly</p></th>
<th class="head"><p>Short period</p></th>
<th class="head"><p>Long period</p></th>
<th class="head"><p>Error Column</p></th>
<th class="head"><p>Sum trading day weights over contributors returned period</p></th>
<th class="head"><p>Num days in contributors returned period</p></th>
<th class="head"><p>Actual period start date</p></th>
<th class="head"><p>Actual period end date</p></th>
<th class="head"><p>Num days in actual returned period</p></th>
<th class="head"><p>Sum trading day weights over actual returned period</p></th>
<th class="head"><p>Date adjusted Q20</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>1184</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
<td><p></p></td>
<td><p>4.400000000000001</p></td>
<td><p>30</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>30</p></td>
<td><p>4.400000000000001</p></td>
<td><p>1184.0</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>2022-06-04</p></td>
<td><p>2022-06-30</p></td>
<td><p>2045</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
<td><p></p></td>
<td><p>3.800000000000001</p></td>
<td><p>27</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>30</p></td>
<td><p>4.400000000000001</p></td>
<td><p>2367.8947368421054</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-24</p></td>
<td><p>2013</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
<td><p></p></td>
<td><p>3.600000000000001</p></td>
<td><p>24</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>30</p></td>
<td><p>4.400000000000001</p></td>
<td><p>2460.3333333333335</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-07-04</p></td>
<td><p>1992</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
<td><p></p></td>
<td><p>4.800000000000002</p></td>
<td><p>34</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>30</p></td>
<td><p>4.400000000000001</p></td>
<td><p>1826.0</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>2022-05-30</p></td>
<td><p>2022-06-28</p></td>
<td><p>1027</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>A</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>N</p></td>
<td><p>24</p></td>
<td><p>42</p></td>
<td><p></p></td>
<td><p>4.400000000000001</p></td>
<td><p>30</p></td>
<td><p>2022-06-01</p></td>
<td><p>2022-06-30</p></td>
<td><p>30</p></td>
<td><p>4.400000000000001</p></td>
<td><p>1027.0</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="example-synthetic-data">
<h3>Example (Synthetic) Data<a class="headerlink" href="#example-synthetic-data" title="Link to this heading">#</a></h3>
<p>Files containing the example input &amp; output data given above can be found in the <a class="reference external" href="https://github.com/ONSdigital/sml-public/tree/main/example_data/DateAdjustment">example_data</a> folder of this repository.</p>
<p>Input &amp; Trading day data:</p>
<p><code class="docutils literal notranslate"> <span class="pre">date_adjustment_input_data_example_1.csv</span> </code></p>
<p><code class="docutils literal notranslate"> <span class="pre">date_adjustment_trading_day_weights_example_1.csv</span> </code></p>
<p>Expected output after running the worked example:</p>
<p><code class="docutils literal notranslate"> <span class="pre">date_adjustment_output_data_example_1.csv</span> </code></p>
</section>
</section>
<section id="worked-example">
<h2>Worked Example<a class="headerlink" href="#worked-example" title="Link to this heading">#</a></h2>
<p>Using the example input data and trading day data, we can then run the method as shown below ensuring that we are calling the right columns from the dataframe:</p>
<div class="highlight-py notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sml_small.date_adjustment</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">date_adjust</span>

<span class="c1"># Import datafile containing the respondent&#39;s data</span>
<span class="n">datafile</span> <span class="o">=</span> <span class="s2">&quot;date_adjustment_input_data_example_1.csv&quot;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span>

<span class="c1"># Import trading day weights file</span>
<span class="n">trading_day_datafile</span> <span class="o">=</span> <span class="s2">&quot;date_adjustment_trading_day_weights_example_1.csv&quot;</span>

<span class="n">trading_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">trading_day_datafile</span><span class="p">)</span>

<span class="c1"># Match up column names with with variables below</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">date_adjust</span><span class="o">.</span><span class="n">date_adjustment</span><span class="p">(</span>
    <span class="n">input_dataframe</span> <span class="o">=</span> <span class="n">df</span><span class="p">,</span> <span class="c1"># Respondent&#39;s input dataframe</span>
    <span class="n">trading_weights</span> <span class="o">=</span> <span class="n">trading_df</span><span class="p">,</span> <span class="c1"># trading day weights dataframe</span>
    <span class="n">target_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Q20&#39;</span><span class="p">],</span> <span class="c1"># The variable that needs to be date adjusted</span>
    <span class="n">contributor_returned_start_date_col</span> <span class="o">=</span> <span class="s2">&quot;Contributors start date&quot;</span><span class="p">,</span> <span class="c1"># Contributor returned start date</span>
    <span class="n">contributor_returned_end_date_col</span> <span class="o">=</span> <span class="s2">&quot;Contributors end date&quot;</span><span class="p">,</span> <span class="c1"># Contributor returned end date</span>
    <span class="n">expected_start_date_col</span> <span class="o">=</span> <span class="s2">&quot;Expected start date&quot;</span><span class="p">,</span> <span class="c1"># Expected start date</span>
    <span class="n">expected_end_date_col</span> <span class="o">=</span> <span class="s2">&quot;Expected end date&quot;</span><span class="p">,</span> <span class="c1"># Expected end date</span>
    <span class="n">domain_col</span> <span class="o">=</span> <span class="s2">&quot;Domain&quot;</span><span class="p">,</span> <span class="c1"># Domain classification</span>
    <span class="n">short_period_parameter_col</span> <span class="o">=</span> <span class="s2">&quot;Short period&quot;</span><span class="p">,</span> <span class="c1"># Short period</span>
    <span class="n">long_period_parameter_col</span> <span class="o">=</span> <span class="s2">&quot;Long period&quot;</span><span class="p">,</span> <span class="c1"># Long period</span>
    <span class="n">equal_weighted_col</span> <span class="o">=</span> <span class="s2">&quot;Equal-weighted&quot;</span><span class="p">,</span> <span class="c1"># Equal-weighted column</span>
    <span class="n">set_to_mid_point_col</span> <span class="o">=</span> <span class="s2">&quot;Mid-point&quot;</span><span class="p">,</span> <span class="c1"># Mid-point indicator column</span>
    <span class="n">use_calendar_days_col</span> <span class="o">=</span> <span class="s2">&quot;Calendar days&quot;</span><span class="p">,</span> <span class="c1"># Calendar days column</span>
    <span class="n">average_weekly_col</span> <span class="o">=</span> <span class="s2">&quot;Average Weekly&quot;</span><span class="p">,</span> <span class="c1"># Average weekly indicator</span>
    <span class="n">da_error_flag_col</span> <span class="o">=</span> <span class="s2">&quot;Error column&quot;</span><span class="p">,</span> <span class="c1"># Column for errors to be populated</span>
    <span class="n">trading_date_col</span> <span class="o">=</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="c1"># Date in the trading day dataframe</span>
    <span class="n">trading_period_start_col</span> <span class="o">=</span> <span class="s2">&quot;period_start&quot;</span><span class="p">,</span> <span class="c1"># Start date column in trading day dataframe</span>
    <span class="n">trading_period_end_col</span> <span class="o">=</span> <span class="s2">&quot;period_end&quot;</span><span class="p">,</span> <span class="c1"># End date column in trading day dataframe</span>
    <span class="n">trading_weights_col</span> <span class="o">=</span> <span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="c1"># Weight values for each date</span>
    <span class="n">trading_domain_col</span> <span class="o">=</span> <span class="s2">&quot;domain&quot;</span> <span class="c1"># Domain for each date and weight</span>
    <span class="p">)</span>
                    
<span class="c1"># Exporting the output file to csv</span>
<span class="n">output</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;date_adjustment_output_data_example_1.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The output can be exported as a csv file and will give you the adjusted responses along with the sum of the weights.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="methodology">
<h1>Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h1>
<section id="terminology">
<h2>Terminology<a class="headerlink" href="#terminology" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Expected period start date – The expected start date of the period set by the user.</p></li>
<li><p>Expected period end date – The expected end date of the period set by the user.</p></li>
<li><p>Variable(s) to be date adjusted – The user can select one or more variables to be date adjusted.</p></li>
<li><p>Contributor’s returned start date – The start date of the period returned by a respondent/observed in the data.</p></li>
<li><p>Contributor’s returned end date – The end date of the period returned by a respondent/observed in the data.</p></li>
<li><p>Domain – Classification group.</p></li>
<li><p>Set to mid-point – Allows the user to apply the mid-point method described below.</p></li>
<li><p>Set to equal weighted – Allows the user to apply the equal weighted method described below.</p></li>
<li><p>Use calendar days – Allows the user to apply the calendar days method described below.</p></li>
<li><p>Average weekly – Allows the user to apply the average weekly method described below.</p></li>
<li><p>Short period parameter – This is used to raise a flag to alert the user that the contributor’s returned period is short.</p></li>
<li><p>Long period parameter – This is used to raise a flag to alert the user that the contributor’s returned period is long.</p></li>
<li><p>Date mapping – This is a file which contains dates and relevant trading day weights per domain.</p></li>
<li><p>Trading day weights: These are weights associated with each day to allow the user to give a higher value to certain days relative to others in a given period. For example, setting weights of 0.2 for weekdays and 0 for weekends when considering turnover data values would imply that turnover is not generated on the weekend and is stable throughout weekdays.</p></li>
<li><p>Sum of trading day weights over contributor’s period: The trading day weights will be summed over the dates returned; all dates are inclusive.</p></li>
<li><p>Number of days in contributor’s returned period: The number of days returned by the contributor; all dates are inclusive.</p></li>
<li><p>Actual period start date: Will appear on the output dataset and is the start date that the output is based on.</p></li>
<li><p>Actual period end date: Will appear on the output dataset and is the end date that the output is based on.</p></li>
<li><p>Number of days in actual returned period: The number of days the user set.</p></li>
<li><p>Sum of trading day weights over actual period: The sum of the trading weights over the days set by the user.</p></li>
<li><p>Date adjusted variable: The adjusted data value based on the sum of the trading days weights ratio.</p></li>
</ul>
</section>
<section id="statistical-process-flow-formal-definition">
<h2>Statistical Process Flow / Formal Definition<a class="headerlink" href="#statistical-process-flow-formal-definition" title="Link to this heading">#</a></h2>
<p>The basic date adjustment method is:</p>
<p><code class="docutils literal notranslate"> <span class="pre">Adjusted</span> <span class="pre">response</span> <span class="pre">=</span> <span class="pre">Original</span> <span class="pre">response</span> <span class="pre">*</span> <span class="pre">Sum</span> <span class="pre">of</span> <span class="pre">weights</span> <span class="pre">of</span> <span class="pre">desired</span> <span class="pre">period</span> <span class="pre">/</span> <span class="pre">Sum</span> <span class="pre">of</span> <span class="pre">weights</span> <span class="pre">of</span> <span class="pre">response</span> </code></p>
<p>A contributor will give a response for a period, this does not have to match the expected period, and will be fed into the method. Data which have the same returned and expected start and end dates may have this method applied but no adjustments will be made as the input data is fit for purpose. Where this is not the case trading day weights are assigned to each day covered by the contributor’s returned period and the expected period. These are then summed to provide a sum for the total trading day weights for the returned and expected periods respectively. The expected period total trading day weights are divided by the contributor’s returned period total trading day weights. This ratio is then applied to the contributor’s response so that it is representative of the expected period.</p>
<p><strong>Incomplete or erroneous data provided</strong>
Contributors may not always provide full or correct data and the Date Adjustment method will handle it by producing error codes. There are 16 error codes and the explanation of each of the codes can be found below:</p>
<p>E00: Average Weekly parameter is invalid.
E01: The value to be date adjusted is missing from one of the target columns.
E02: The contributor returned end date is earlier than the contributor returned start date.
E03: A required record for calculating weight m is missing from the trading weights table.
E04: A required trading weight for calculating weight m is null or blank.
E05: A required trading weight for calculating weight m has a negative value.
E06: A required record for calculating weight n is missing from or duplicated in the trading weights table.
E07: A required trading weight for calculating weight n is null or blank.
E08: A required trading weight for calculating weight n has a negative value.
E09: Contributors return does not cover any of expected period.
E10: The sum of trading day weights over contributors returned period is zero.
E11: The sum of trading day weights over contributors returned period is zero.
E12: A required record for calculating midpoint date is missing from the trading weights table.
E13: A required record for setting APS and APE by midpoint is missing from or duplicated in the trading weights table.
E14: Expected period start date is missing or an invalid date.
E15: Expected period end date is missing or an invalid date.
These are NOT exceptions and do not cause the method to fail. Once an error flag has been placed on a row of data, no further processing is done to that row, preserving the data in the state it was when the flag was raised. The method will continue processing even when errors occur, this was done for historical reasons.</p>
<p><strong>Set to Mid-point – set as Y or YT or N</strong>
A mid-point method can be used in Date Adjustment to check whether a contributor’s returned dates are within the expected period. If the mid-point of the contributor’s returned start and end dates are outside the expected period, then a “C” flag is raised in the error flag column to inform the user that the contributor’s response data aligns with a different reporting period (i.e., not the expected period). If the respondent’s mid-point does lie outside of the period, the user is interested in then date adjustment will not occur.</p>
<p>There are two ways to use the mid-point method: set the mid-point to “Y” and set the mid-point to “YT”. Setting the mid-point input parameter to “Y” will simply calculate the mid-point of the days returned. If the number of days in the contributor’s returned period are even, then divide the count by 2 and add that to the contributor’s returned start date to find the mid-point. If the number of days in the contributor’s returned period are odd, then add 1 to the count and divide by 2. This is then added onto the contributor’s returned start date. If the user sets the mid-point input parameter to “YT”, then the method will trim any weighted days at the start or end of the contributor’s returned dates if they have trading day weights set to 0 and do the same calculation as above with regards to the number of days in the period. Therefore, each method could provide a slightly different answer. If the user does not want the mid-point method to occur, then please set this to “N”.</p>
<p><strong>Use calendar days – set as Y or N</strong>
If the mid-point lies outside of the expected period start and end dates, a “C” flag is raised in the Date change column. Calendar days function will only work when there is a “C” flag present. The calendar days function, when set to “Y”, allows the user to automatically set the expected start and end period dates to the first day and last day of the month where the mid-point lies. When the calendar days function is set to “N” it allows start and end period dates to be set to the start and end dates that “C” flag lies in.</p>
<p><strong>Set to equal weighted – set to Y or N</strong>
The equal weighted method is where all the trading day weights are set to 1 instead of having a unique trading day weight associated with each day. This can be a useful feature when each day is of equal importance with respect to the data collected. To use this feature, the equal-weighted column should be marked as “Y”. If the user does not want the trading day weights to be equal-weighted, then please set this to “N”.</p>
<p><strong>Average weekly – set to A or N</strong>
The average weekly function allows the responses to be given on a weekly value rather than the period specified by the user. This can be a useful tool when the user’s period isn’t always equal, to allow the user to compare similar values. To use this feature, the average weekly value will need to be set to “A”. If the user does not want to have average weekly values in the output, then please set this to “N”.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="additional-information">
<h1>Additional Information<a class="headerlink" href="#additional-information" title="Link to this heading">#</a></h1>
<p>The ONS Statistical Methods Library at <a class="reference external" href="https://statisticalmethodslibrary.ons.gov.uk/">https://statisticalmethodslibrary.ons.gov.uk/</a>
contains:</p>
<ul class="simple">
<li><p>Further information about the methods including a link to the GitHub repository which contains detailed API information as part of the method code.</p></li>
<li><p>Information about other methods available through the library.</p></li>
</ul>
<section id="license">
<h2>License<a class="headerlink" href="#license" title="Link to this heading">#</a></h2>
<p>Unless stated otherwise, the SML codebase is released under the MIT License. This covers both the codebase and any sample code in the documentation.</p>
<p>The documentation is available under the terms of the Open Government 3.0 license.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./public_guides"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="CellKeyPerturbation_Py.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Cell Key Perturbation in Python</p>
      </div>
    </a>
    <a class="right-next"
       href="SelectiveEditing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Selective Editing in Python</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Date Adjustment in Python</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#sml-user-guide">SML User Guide</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#user-notes">User Notes</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-and-installing-the-method">Finding and Installing the method</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#requirements-and-dependencies">Requirements and Dependencies</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#assumptions-and-validity">Assumptions and Validity</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-the-method">How to Use the Method</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-input">Method Input</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#input-data">Input Data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#trading-day-data">Trading Day Data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-output">Method Output</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#output-data">Output Data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-synthetic-data">Example (Synthetic) Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#worked-example">Worked Example</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">Methodology</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#terminology">Terminology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#statistical-process-flow-formal-definition">Statistical Process Flow / Formal Definition</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#additional-information">Additional Information</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#license">License</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By ONS Statistical Methods Library
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>